model InfrastructureNode {
  id String @id @default(uuid())

  taskName  String
  slug      String @unique

  nodeType  String?
  programId String?

  duration            Int      @default(0)
  startDate           DateTime @default(now())
  finishDate          DateTime @default(now())
  priority            String   @default("NONE")
  actualHour          Float    @default(0)
  plannedHour         Float    @default(0)
  plannedCost         Float    @default(0)
  plannedResourceCost Float    @default(0)

  // Progress 
  progress         Float? // only leaf
  computedProgress Float   @default(0)
  weight           Float   @default(1)
  isLeaf           Boolean @default(true)

  // *** NEW FIELD: Store chart values for this specific node ***
  // For leaf nodes: User-entered values { "Sun": 8, "Mon": 0, "Tue": 3 }
  // For parent nodes: Auto-calculated sum of children's values
  chartValues Json? // @default("{}")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  projectId String
  project   Project @relation(fields: [projectId], references: [id])
  parentId  String?

  parent      InfrastructureNode?  @relation("NodeChildren", fields: [parentId], references: [id], onDelete: Cascade)
  children    InfrastructureNode[] @relation("NodeChildren")
  nodeChart   ChartTable?          @relation("NodeChart", fields: [nodeChartId], references: [id], onDelete: Cascade)
  nodeChartId String?              @unique

  @@index([projectId])
  @@index([parentId])
  @@index([isLeaf])
  @@index([slug, id])
}